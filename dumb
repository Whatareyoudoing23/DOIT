-- Fight Tool Script (LocalScript in StarterPack > Fight)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local HitEvent = ReplicatedStorage:WaitForChild("HitEvent")
local player = Players.LocalPlayer
local tool = script.Parent

-- Detect when tool is activated (e.g., clicked to punch)
tool.Activated:Connect(function()
    if not player.Character then return end
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return end

    -- Check for WeaveStun on attacker
    local actionsFolder = player.Character:FindFirstChild("Actions") or Instance.new("Folder", player.Character)
    actionsFolder.Name = "Actions"
    local weaveStun = actionsFolder:FindFirstChild("WeaveStun") or Instance.new("BoolValue", actionsFolder)
    weaveStun.Name = "WeaveStun"
    weaveStun.Value = weaveStun.Value or false

    if not weaveStun.Value then
        -- Simulate a punch (basic hitbox detection)
        local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local hitbox = Instance.new("Part")
            hitbox.Size = Vector3.new(5, 5, 5)
            hitbox.CFrame = rootPart.CFrame * CFrame.new(0, 0, -3)
            hitbox.Anchored = true
            hitbox.CanCollide = false
            hitbox.Transparency = 1
            hitbox.Parent = workspace

            -- Detect hits
            local touchingParts = hitbox:GetTouchingParts()
            for _, part in ipairs(touchingParts) do
                local hitCharacter = part.Parent
                local hitPlayer = Players:GetPlayerFromCharacter(hitCharacter)
                if hitPlayer and hitPlayer ~= player then
                    -- Fire HitEvent to the hit player's client
                    HitEvent:FireClient(hitPlayer, player)
                end
            end
            game:GetService("Debris"):AddItem(hitbox, 0.1)
        end
    end
end)

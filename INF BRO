local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Whitelist table with UserIds
local Whitelist = {
    123456789,
    987654321,
}

local player = Players.LocalPlayer
local isWhitelisted = false

-- Check if the player is whitelisted
for _, userId in ipairs(Whitelist) do
    if player.UserId == userId then
        isWhitelisted = true
        break
    end
end

-- Disconnect non-whitelisted players
if not isWhitelisted then
    player:Kick("You are not whitelisted. Contact the developer to be whitelisted.")
    return -- Stop script execution for non-whitelisted players
end

-- Auto-weave configuration
local CG_AutoWeave = true
local CG_AutoWeave_ActivationDelay = 0.022
local WeaveKey = Enum.KeyCode.T
local FistToolName = "Fist"

local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")
local isWeaving = CG_AutoWeave
local lastWeaveTime = 0

-- Check if the "Fist" tool is equipped
local function areFistsEquipped()
    local equippedTool = character:FindFirstChildOfClass("Tool")
    return equippedTool and equippedTool.Name == FistToolName
end

-- Perform the weave movement
local function performWeave(deltaTime)
    if not isWeaving or not character or not humanoid or humanoid.Health <= 0 or not areFistsEquipped() then
        return
    end

    lastWeaveTime = lastWeaveTime + deltaTime
    if lastWeaveTime < CG_AutoWeave_ActivationDelay then
        return
    end
    lastWeaveTime = 0

    local offsetAmplitude = 0.5
    local randomOffset = Vector3.new(
        math.random(-offsetAmplitude, offsetAmplitude),
        0,
        math.random(-offsetAmplitude, offsetAmplitude)
    )

    rootPart.CFrame = CFrame.new(rootPart.Position + randomOffset) * rootPart.CFrame.Rotation
end

-- Toggle weaving with the specified key
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then
        return
    end

    if input.KeyCode == WeaveKey then
        isWeaving = not isWeaving
    end
end)

-- Update weaving every frame
RunService.Heartbeat:Connect(function(deltaTime)
    if isWeaving and areFistsEquipped() then
        performWeave(deltaTime)
    end
end)

-- Handle character respawn
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = character:WaitForChild("Humanoid")
    rootPart = character:WaitForChild("HumanoidRootPart")
    isWeaving = CG_AutoWeave
    lastWeaveTime = 0
end)

-- Handle tool equip/unequip (optional, currently empty)
player.Character.ChildAdded:Connect(function(child)
    if child:IsA("Tool") and child.Name == FistToolName and isWeaving then
        -- Add logic here if needed (e.g., notify player or enable weaving)
    end
end)

player.Character.ChildRemoved:Connect(function(child)
    if child:IsA("Tool") and child.Name == FistToolName then
        -- Add logic here if needed (e.g., disable weaving)
    end
end)
